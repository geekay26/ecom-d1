---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import ProductGrid from "../components/ProductGrid";
import CategoryNav from "../components/CategoryNav.astro";
import { getProducts } from "../lib/products";

// Get cookie from request
const isBookmark = Astro.cookies.has("product_bookmark");
const bookmark = isBookmark
  ? Astro.cookies.get("product_bookmark")?.value
  : null;
console.log("Bookmark cookie value:", bookmark);

// Fetch products from read replica
const products = await getProducts();
const categories = [...new Set(products.map((p) => p.category))];
---

<Layout title="E-commerce Store">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <CategoryNav categories={categories} />
    <ProductGrid client:load products={products} />
    <!-- Debug element to see value in rendered HTML -->
    {(<div class="hidden">Debug bookmark: {bookmark || "no bookmark"}</div>)}
  </div>
</Layout>
